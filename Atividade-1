import json

tarefas = []
historico = []
fila_execucao = []
NOME_ARQUIVO = "tarefas.txt"

def adicionar_tarefa(tarefa):
    prioridade = input("Digite a prioridade (alta, m√©dia, baixa) ou deixe em branco: ").strip().lower()
    nova_tarefa = {"descricao": tarefa, "prioridade": prioridade}
    tarefas.append(nova_tarefa)
    historico.append(nova_tarefa)
    fila_execucao.append(nova_tarefa)
    salvar_tarefas()
    print(f"Tarefa '{tarefa}' adicionada!\n")

def desfazer_ultima_tarefa():
    if historico:
        ultima = historico.pop()
        tarefas.remove(ultima)
        fila_execucao.remove(ultima)
        salvar_tarefas()
        print(f"Tarefa '{ultima['descricao']}' desfeita!\n")
    else:
        print("Nenhuma tarefa para desfazer.\n")

def atender_tarefa():
    if fila_execucao:
        feita = fila_execucao.pop(0)
        tarefas.remove(feita)
        salvar_tarefas()
        print(f"Tarefa '{feita['descricao']}' atendida!\n")
    else:
        print("Nenhuma tarefa para atender.\n")

def mostrar_tarefas():
    print("\nüìã Lista de Tarefas:")
    if tarefas:
        for i, t in enumerate(tarefas):
            info = f"{i + 1}. {t['descricao']}"
            if t.get('prioridade'):
                info += f" (Prioridade: {t['prioridade']})"
            print(info)
    else:
        print("Nenhuma tarefa na lista.")
    print()

def salvar_tarefas():
    with open(NOME_ARQUIVO, 'w') as arquivo:
        json.dump(tarefas, arquivo)
    print(f"Tarefas salvas em '{NOME_ARQUIVO}'.")

def carregar_tarefas():
    try:
        with open(NOME_ARQUIVO, 'r') as arquivo:
            global tarefas, historico, fila_execucao
            tarefas = json.load(arquivo)
            historico = list(tarefas)
            fila_execucao = list(tarefas)
        print(f"Tarefas carregadas de '{NOME_ARQUIVO}'.")
    except FileNotFoundError:
        print(f"Arquivo '{NOME_ARQUIVO}' n√£o encontrado. Iniciando com uma lista de tarefas vazia.")

carregar_tarefas()

while True:
    print("1. Adicionar Tarefa")
    print("2. Desfazer √öltima Tarefa")
    print("3. Atender Tarefa (modo fila)")
    print("4. Mostrar Tarefas")
    print("5. Sair")

    opcao = input("Escolha uma op√ß√£o: ")

    if opcao == '1':
        tarefa = input("Digite a tarefa: ")
        adicionar_tarefa(tarefa)
    elif opcao == '2':
        desfazer_ultima_tarefa()
    elif opcao == '3':
        atender_tarefa()
    elif opcao == '4':
        mostrar_tarefas()
    elif opcao == '5':
        print("Saindo do programa...")
        break
    else:
        print("Op√ß√£o inv√°lida!\n")
